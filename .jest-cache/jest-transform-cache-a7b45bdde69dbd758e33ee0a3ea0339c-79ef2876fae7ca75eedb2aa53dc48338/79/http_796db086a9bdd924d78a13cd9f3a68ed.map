{"version":3,"names":["axios","require","http","https","config","httpAgent","Agent","keepAlive","httpsAgent","wpClient","create","baseURL","wordpress","url","timeout","headers","process","env","USE_MOCKS","fs","path","console","log","defaults","adapter","Promise","resolve","reject","mockFile","regex","match","ns","resource","id","folderNs","baseDir","cwd","specific","join","def","existsSync","list","rootDefault","data","JSON","parse","readFileSync","status","statusText","request","e","message","response","name","code","getWcAuthHeader","auth","Buffer","from","wcConsumerKey","wcConsumerSecret","toString","getLdAuthHeader","ldUser","ldAppPassword","module","exports"],"sources":["http.js"],"sourcesContent":["const axios = require('axios');\nconst http = require('http');\nconst https = require('https');\nconst config = require('../config');\n\nconst httpAgent = new http.Agent({ keepAlive: true });\nconst httpsAgent = new https.Agent({ keepAlive: true });\n\nconst wpClient = axios.create({\n    baseURL: config.wordpress.url,\n    timeout: 15000, // 15 seconds default timeout\n    httpAgent,\n    httpsAgent,\n    headers: {\n        'Content-Type': 'application/json',\n    },\n});\n\n// Mock Adapter Implementation\nif (process.env.USE_MOCKS === 'true') {\n    const fs = require('fs');\n    const path = require('path');\n    console.log('⚠️  USING MOCKS FOR EXTERNAL HTTP CALLS ⚠️');\n\n    wpClient.defaults.adapter = async (config) => {\n        return new Promise((resolve, reject) => {\n            const url = config.url || '';\n            let mockFile = '';\n\n            // Generic Router\n            // Matches: /<namespace>/<version>/<resource>[/<id>]\n            // namespaces: wc/v3 -> wc, ldlms/v2 -> ld, wp/v2 -> wp\n            const regex = /^\\/?(?:(wc)\\/v3|(ldlms)\\/v2|(wp)\\/v2)\\/([^\\/?]+)(?:\\/([^\\/?]+))?/;\n            const match = url.match(regex);\n\n            if (match) {\n                const ns = match[1] || match[2] || match[3]; // wc or ldlms (ld) or wp\n                const resource = match[4]; // e.g., products, sfwd-courses\n                const id = match[5]; // optional ID\n\n                // Map 'ldlms' to 'ld' folder\n                const folderNs = ns === 'ldlms' ? 'ld' : ns;\n\n                const baseDir = path.resolve(process.cwd(), `mocks/wordpress/${folderNs}/${resource}`);\n\n                if (id) {\n                    // Try specific ID\n                    const specific = path.join(baseDir, `${id}.json`);\n                    const def = path.join(baseDir, 'default.json');\n\n                    if (fs.existsSync(specific)) {\n                        mockFile = specific;\n                    } else if (fs.existsSync(def)) {\n                        mockFile = def;\n                    } else {\n                        // Fallback: Check if list exists, maybe? No, usually ID call expects object.\n                        // If really nothing found, we let fall through to 404\n                    }\n                } else {\n                    // List\n                    const list = path.join(baseDir, 'list.json');\n                    if (fs.existsSync(list)) {\n                        mockFile = list;\n                    }\n                    // Some endpoints like singletons (users-course-progress) might behave like \"default\" without ID?\n                    // Check if there is a 'default.json' for the resource root? \n                    // e.g. users-course-progress_v2/default.json\n                    const rootDefault = path.join(baseDir, 'default.json');\n                    if (!mockFile && fs.existsSync(rootDefault)) {\n                        mockFile = rootDefault;\n                    }\n                }\n            } else {\n                console.log(`[MOCK] URL ${url} did not match supported patterns.`);\n            }\n\n            if (mockFile && fs.existsSync(mockFile)) {\n                try {\n                    const data = JSON.parse(fs.readFileSync(mockFile, 'utf8'));\n                    console.log(`[MOCK] Serving ${mockFile} for ${url}`);\n                    resolve({\n                        data,\n                        status: 200,\n                        statusText: 'OK',\n                        headers: {},\n                        config,\n                        request: {}\n                    });\n                } catch (e) {\n                    reject({ message: 'Failed to parse mock file', config, response: { status: 500 } });\n                }\n            } else {\n                console.log(`[MOCK] No mock found for ${url}, returning 404`);\n                // Simulate 404 for unknown mocks\n                reject({\n                    message: 'Request failed with status code 404',\n                    name: 'AxiosError',\n                    code: 'ERR_BAD_REQUEST',\n                    config,\n                    response: {\n                        status: 404,\n                        statusText: 'Not Found',\n                        data: { code: 'rest_no_route', message: 'No route was found matching the URL and request method', data: { status: 404 } }\n                    }\n                });\n            }\n        });\n    };\n}\n\n// Helper for Basic Auth (WooCommerce)\nconst getWcAuthHeader = () => {\n    const auth = Buffer.from(`${config.wordpress.wcConsumerKey}:${config.wordpress.wcConsumerSecret}`).toString('base64');\n    return `Basic ${auth}`;\n};\n\n// Helper for Application Password (LearnDash)\nconst getLdAuthHeader = () => {\n    const auth = Buffer.from(`${config.wordpress.ldUser}:${config.wordpress.ldAppPassword}`).toString('base64');\n    return `Basic ${auth}`;\n};\n\nmodule.exports = {\n    wpClient,\n    getWcAuthHeader,\n    getLdAuthHeader\n};\n"],"mappings":"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","ignoreList":[]}