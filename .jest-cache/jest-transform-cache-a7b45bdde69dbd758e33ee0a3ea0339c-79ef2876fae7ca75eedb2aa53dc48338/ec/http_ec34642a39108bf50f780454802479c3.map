{"version":3,"names":["axios","require","http","https","config","httpAgent","Agent","keepAlive","httpsAgent","wpClient","create","baseURL","wordpress","url","timeout","headers","process","env","USE_MOCKS","fs","path","console","log","defaults","adapter","Promise","resolve","reject","mockFile","includes","id","split","pop","specificMock","cwd","existsSync","data","JSON","parse","readFileSync","status","statusText","request","e","message","response","name","code","getWcAuthHeader","auth","Buffer","from","wcConsumerKey","wcConsumerSecret","toString","getLdAuthHeader","ldUser","ldAppPassword","module","exports"],"sources":["http.js"],"sourcesContent":["const axios = require('axios');\nconst http = require('http');\nconst https = require('https');\nconst config = require('../config');\n\nconst httpAgent = new http.Agent({ keepAlive: true });\nconst httpsAgent = new https.Agent({ keepAlive: true });\n\nconst wpClient = axios.create({\n    baseURL: config.wordpress.url,\n    timeout: 15000, // 15 seconds default timeout\n    httpAgent,\n    httpsAgent,\n    headers: {\n        'Content-Type': 'application/json',\n    },\n});\n\n// Mock Adapter Implementation\nif (process.env.USE_MOCKS === 'true') {\n    const fs = require('fs');\n    const path = require('path');\n    console.log('⚠️  USING MOCKS FOR EXTERNAL HTTP CALLS ⚠️');\n\n    wpClient.defaults.adapter = async (config) => {\n        return new Promise((resolve, reject) => {\n            const url = config.url || '';\n            let mockFile = '';\n\n            // Map URLs to Mock Files\n            if (url.includes('/wc/v3/products/')) {\n                // Try to get ID\n                const id = url.split('/').pop();\n                const specificMock = path.resolve(process.cwd(), `mocks/wordpress/wc/product_${id}.json`);\n                if (fs.existsSync(specificMock)) {\n                    mockFile = specificMock;\n                } else {\n                    mockFile = path.resolve(process.cwd(), 'mocks/wordpress/wc/product_default.json');\n                }\n            } else if (url.includes('/ldlms/v2/sfwd-courses/')) {\n                const id = url.split('/').pop();\n                const specificMock = path.resolve(process.cwd(), `mocks/wordpress/ld/course_${id}.json`);\n                if (fs.existsSync(specificMock)) {\n                    mockFile = specificMock;\n                } else {\n                    // Fallback to 101 if specific not found\n                    mockFile = path.resolve(process.cwd(), 'mocks/wordpress/ld/course_101.json');\n                }\n            }\n\n            if (mockFile && fs.existsSync(mockFile)) {\n                try {\n                    const data = JSON.parse(fs.readFileSync(mockFile, 'utf8'));\n                    console.log(`[MOCK] Serving ${mockFile} for ${url}`);\n                    resolve({\n                        data,\n                        status: 200,\n                        statusText: 'OK',\n                        headers: {},\n                        config,\n                        request: {}\n                    });\n                } catch (e) {\n                    reject({ message: 'Failed to parse mock file', config, response: { status: 500 } });\n                }\n            } else {\n                console.log(`[MOCK] No mock found for ${url}, returning 404`);\n                // Simulate 404 for unknown mocks\n                reject({\n                    message: 'Request failed with status code 404',\n                    name: 'AxiosError',\n                    code: 'ERR_BAD_REQUEST',\n                    config,\n                    response: {\n                        status: 404,\n                        statusText: 'Not Found',\n                        data: { code: 'rest_no_route', message: 'No route was found matching the URL and request method', data: { status: 404 } }\n                    }\n                });\n            }\n        });\n    };\n}\n\n// Helper for Basic Auth (WooCommerce)\nconst getWcAuthHeader = () => {\n    const auth = Buffer.from(`${config.wordpress.wcConsumerKey}:${config.wordpress.wcConsumerSecret}`).toString('base64');\n    return `Basic ${auth}`;\n};\n\n// Helper for Application Password (LearnDash)\nconst getLdAuthHeader = () => {\n    const auth = Buffer.from(`${config.wordpress.ldUser}:${config.wordpress.ldAppPassword}`).toString('base64');\n    return `Basic ${auth}`;\n};\n\nmodule.exports = {\n    wpClient,\n    getWcAuthHeader,\n    getLdAuthHeader\n};\n"],"mappings":"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","ignoreList":[]}