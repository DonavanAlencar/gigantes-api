{"version":3,"names":["_getJestObj","mock","getClient","jest","fn","get","set","require","crudService","describe","resources","namespace","resource","mockId","name","listOnly","forEach","testCase","it","data","list","expect","toBeDefined","Array","isArray","code","toBeTruthy","length","toBe","toBeFalsy","total_sales","user","course"],"sources":["generic_crud.test.js"],"sourcesContent":["const crudService = require('../../services/crud');\n\n// Mock Redis to be safe (though crud.js doesn't use it directly, other imports might)\njest.mock('../../services/cache', () => {\n    return {\n        getClient: jest.fn(() => ({\n            get: jest.fn(),\n            set: jest.fn()\n        }))\n    };\n});\n\ndescribe('Generic CRUD Service with Mocks', () => {\n\n    // Define all resources we implemented mocks for\n    const resources = [\n        // WP Core\n        { namespace: 'wp/v2', resource: 'posts', mockId: 1, name: 'WP Posts' },\n        { namespace: 'wp/v2', resource: 'pages', mockId: 2, name: 'WP Pages' }, // List mock has id 2\n        { namespace: 'wp/v2', resource: 'users', mockId: 1, name: 'WP Users' },\n\n        // WooCommerce\n        { namespace: 'wc/v3', resource: 'orders', mockId: 101, name: 'WC Orders' }, // List mock has id 101\n        { namespace: 'wc/v3', resource: 'customers', mockId: 1, name: 'WC Customers' },\n        { namespace: 'wc/v3', resource: 'coupons', mockId: 10, name: 'WC Coupons' }, // List mock has id 10\n        { namespace: 'wc/v3', resource: 'products/categories', mockId: 15, name: 'WC Categories' }, // List mock has id 15\n\n        // LearnDash\n        { namespace: 'ldlms/v2', resource: 'sfwd-lessons', mockId: 201, name: 'LD Lessons' }, // List mock has id 201\n        { namespace: 'ldlms/v2', resource: 'sfwd-quiz', mockId: 301, name: 'LD Quizzes' }, // List mock has id 301\n\n        // Special Read-Only / Custom logic handled by generic crud list\n        { namespace: 'ldlms/v2', resource: 'users-courses', name: 'LD User Courses', listOnly: true },\n    ];\n\n    resources.forEach(testCase => {\n        describe(testCase.name, () => {\n\n            it(`should list ${testCase.name} using mocks`, async () => {\n                const data = await crudService.list(testCase.namespace, testCase.resource);\n                expect(data).toBeDefined();\n                expect(Array.isArray(data) || data.code === 'success').toBeTruthy();\n\n                if (Array.isArray(data) && data.length > 0) {\n                    // Verify we got the mock data we expect\n                    // Most mocks were created with specific data in Stage 2/3\n                    expect(data[0]).toBeDefined();\n                }\n            });\n\n            if (!testCase.listOnly) {\n                it(`should get ${testCase.name} by ID using mocks`, async () => {\n                    // For Get By ID, our Mock Adapter logic (Stage 2) looks for:\n                    // 1. mocks/.../<id>.json\n                    // 2. OR mocks/.../default.json\n                    // We ensured default.json exists or specific IDs exists.\n\n                    // We pass a random ID 999 to force 'default.json' fallback if specific doesn't exist,\n                    // OR we pass the ID we know exists in the 'list' mock if we want to be clean.\n                    // However, the Adapter logic for ID is: Check <id>.json, then default.json.\n                    // To ensure it works generally, checking 999 (default) is a good test of the fallback.\n\n                    const data = await crudService.get(testCase.namespace, testCase.resource, 999);\n                    expect(data).toBeDefined();\n                    // Should be an object\n                    expect(typeof data).toBe('object');\n                    expect(Array.isArray(data)).toBeFalsy();\n                });\n            }\n        });\n    });\n\n    // Specific verification for nested report\n    describe('WC Reports', () => {\n        it('should fetch sales report', async () => {\n            const data = await crudService.list('wc/v3', 'reports/sales');\n            expect(Array.isArray(data)).toBeTruthy();\n            if (data.length > 0) {\n                expect(data[0].total_sales).toBeDefined();\n            }\n        });\n    });\n\n    // Specific verification for User Progress (default.json logic)\n    describe('LD User Progress', () => {\n        it('should fetch user progress', async () => {\n            const data = await crudService.list('ldlms/v2', 'users-course-progress_v2', { user: 1, course: 2553 });\n            // This endpoint mock returns an object, not array, in default.json\n            expect(data).toBeDefined();\n            expect(data.code).toBe('success');\n        });\n    });\n});\n"],"mappings":"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","ignoreList":[]}